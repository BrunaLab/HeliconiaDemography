---
title: "R Notebook"
output: html_notebook
---

```{r}
library(IPMpack)
```

Needs particular data.frame format with columns:

- `size`
- `sizeNext`
-  `surv` (1 or 0)
- `fec1`, `fec2`, ...: e.g.
  - `fec1`: probability of reproduction
  - `fec2`: number of reproductive structures (flowers)
  - `fec3`: number of propagules (seeds per flower)
- `stage` Use either this or size.  If size is not `NA`, then this must be `"continuous"`. If this column is missing, it assumes "continuous" for all entries.  Can mix continuous and discrete with this column.
- `stageNext`
- `number` number of individuals corresponding to each row
- `covariate` discrete covariate
- `covariateNext` 
- any other covariates named whatever you want (e.g. SPEI)
- `offspringNext` either "sexual" or "clonal"


```{r}
dff <- generateData()
head(dff)
```

```{r}
plot(dff$size, dff$sizeNext, xlab = "Size at t", ylab = "Size at t+1")
```

Make objects from data frame
uhhnhh what is "size2"?  It's not in the data frame!  Ughhh. I hate this shit.

```{r}
# gr1 <- makeGrowthObj(dataf = dff, Formula = sizeNext~size+size2)

gr1 <- makeGrowthObj(dataf = dff, Formula = sizeNext ~ size + I(size^2))
sv1 <- makeSurvObj(dff, surv ~ size + I(size^2))
```

```{r}
picGrow(dff, gr1)
picSurv(dff, sv1, ncuts = 20)
```

Make $P$ matrix (survival and growth)

```{r}
Pmatrix <- makeIPMPmatrix(nBigMatrix = 50,
                          minSize = -5, maxSize = 35,
                          growObj = gr1, survObj = sv1,
                          correction = "constant")
Pmatrix
# plot(Pmatrix) #nope
image(Pmatrix, xlab = "size at t", ylab = "size at t+1")
persp(Pmatrix, xlab = "size at t", ylab = "size at t+1", zlab = "transition probability")
```

How life expectency relates to size:

```{r}
LE <- meanLifeExpect(Pmatrix)
plot(Pmatrix@meshpoints, LE, type = "l", xlab = "size at t", ylab = "life expectency")
```

Fertilty
```{r}
fv1 <- makeFecObj(dff, Formula = fec ~ size, Family = "gaussian", Transform = "log")
```

